<?php

/**
 * CatedrasTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class CatedrasTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object CatedrasTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Catedras');
    }      
        
    // Obtener la catedra 
	public function obtenerCatedra($idmateriaplan, $idsede) 
	{
		$q = Doctrine_Query::create()
			->select('c.*')
			->from('Catedras c')
			->where('c.idsede = '.$idsede)
			->andWhere('c.idmateriaplan = '.$idmateriaplan);		
   			
		return $q->fetchOne();
	}  
	
	public function getDisponible($idmateria, $idcomision, $idsede=1) 
	{
		$q = Doctrine_Query::create()
			->select('count(am.idalumno) as cantidad')
			->from('AluMat am')
			->where('am.idcomision = '.$idcomision)	 		
			->andWhere('am.idmateria = '.$idmateria);			
   			
		return $q->execute();
	}    

    // Busca todas los alumnos segun los criterios
    public static function buscarCronograma($idplanestudio,$idsede)
    {
	   	$q = Doctrine_Query::create()
	 		->select('c.*')
	 		->from("Catedras c")
	   		->where("c.idsede =".$idsede);
			/*
			->innerJoin('c.Materias m ON c.idmateria = m.idmateria')	
			->innerJoin('m.Materias m ON c.idmateria = m.idmateria')	
	    	->andWhere("a.idplanestudio =".$idplanestudio);
			*/	

		return $q->execute();
    }   

    public function getMateriaPorCatedra($pIdCatedra) {

    	$resultado = Doctrine_Manager::getInstance()->getCurrentConnection()->fetchAssoc("
			SELECT m.nombre FROM materias m 
			JOIN materias_planes mp ON m.idmateria = mp.idmateria 
			JOIN catedras c ON mp.idmateriaplan = c.idmateriaplan 
			WHERE c.idcatedra=".$pIdCatedra. " "
		);

		foreach ($resultado as $info){
			return $info['nombre'];
		}    	
    }     
}