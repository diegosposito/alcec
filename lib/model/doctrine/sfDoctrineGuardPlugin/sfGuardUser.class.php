<?php

/**
 * sfGuardUser
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    sig
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class sfGuardUser extends PluginsfGuardUser
{
  // Busca el grupo del usuario
  public function obtenerGrupoUsuario()
    {
    	$q = Doctrine_Query::create()
	  		->select("*")
	 		->from("sfGuardUserGroup g")
	 		->where("g.user_id = ".$this->getId())
	 		->andWhere("g.group_id = 3")
	    	->fetchOne();
	       
        return $q;
    }            
  // Busca el permiso del usuario
  public function obtenerPermisoUsuario()
    {
    	$q = Doctrine_Query::create()
	  		->select("*")
	 		->from("sfGuardUserPermission p")
	 		->where("p.user_id = ".$this->getId())
	 		->andWhere("p.permission_id = 3")
	    	->fetchOne();
	       
        return $q;
    }    

  // Busca el permiso del usuario
  public function obtenerSistemas()
    {
    	$q = Doctrine_Query::create()
	  		->select('m.idsistema AS idsistema, u.user_id, s.descripcion AS descripcion, s.url AS url, s.url128 AS url128, s.url192 AS url192')
	 		->from('sfGuardUserPermission u')
	 		->innerJoin('u.Permission p ON u.permission_id = p.id')
	 		//->leftJoin('Menu m ON p.name = m.credencial')
	 		->addFrom('Menu m')
			->innerJoin('m.Sistemas s ON m.idsistema = s.id')	 		
	 		->where('u.user_id = '.$this->getId())
	 		->andWhere('m.credencial like p.name')
	 		->groupBy('m.idsistema')
	    	->execute();
      
        return $q;
    }   

  // Busca el permiso del usuario
  public function obtenerSistemasUsuario($credencial)
    {
    	$q = Doctrine_Query::create()
	  		->select('distinct s.descripcion, s.url')
	 		->from('menu m')
	 		->innerJoin('m.Sistemas s ON m.idsistema = s.id')
	 		->where('m.credencial = '.$credencial)
	    	->execute();
      
        return $q;
    }   


}
