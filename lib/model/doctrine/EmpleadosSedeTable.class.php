<?php

/**
 * EmpleadosSedeTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class EmpleadosSedeTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object EmpleadosSedeTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('EmpleadosSede');
    }
    
    // Busca el administrativo contable asignado a dicha sede
    public static function obtenerUsuarios($idsede, $idtipocargo)
    {
    	$arreglo[0] = 'tramitesalumnos@aelf.edu.ar';
    	
    	$q = Doctrine_Manager::getInstance()->getCurrentConnection()->fetchAssoc("
			SELECT pr.sf_guard_user_id AS sf_guard_user_id, us.email_address as email
				FROM profile pr
				INNER JOIN sf_guard_user us
					ON pr.sf_guard_user_id=us.id
				WHERE
					pr.nrodoc IN (
						SELECT pe.nrodoc
    					FROM empleados_sede es
    					INNER JOIN empleados em ON es.idempleado=em.idempleado
    					INNER JOIN personas pe ON em.idpersona=pe.idpersona
    					INNER JOIN designaciones_empleados de ON es.idempleado=de.idempleado
    					WHERE de.idtipocargo=".$idtipocargo." and es.idsede=".$idsede." and pr.idarea!='')"
    	);
    	 
    	foreach ($q as $fila){
    	 $arreglo[$fila['sf_guard_user_id']] = $fila['email'];
    	}

    	return $arreglo;
    }    
    
    // Busca el bibliotecario asignado a dicha sede
    public static function obtenerUsuariosBiblioteca($idsede)
    {
    
    	$q = Doctrine_Manager::getInstance()->getCurrentConnection()->fetchAssoc("
			SELECT pr.sf_guard_user_id AS sf_guard_user_id, us.email_address as email
				FROM profile pr
				INNER JOIN sf_guard_user us
					ON pr.sf_guard_user_id=us.id
				WHERE
    				pr.idarea=30 and pr.idsede=".$idsede
    	);
    
    	foreach ($q as $fila){
    		$arreglo[$fila['sf_guard_user_id']] = $fila['email'];
    	}
    
    	return $arreglo;
    }    
}